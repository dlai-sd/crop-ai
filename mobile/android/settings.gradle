pluginManagement {
    def flutterSdkPath = {
        def flutterRoot = System.getenv("FLUTTER_ROOT")
        if (flutterRoot) {
            return flutterRoot
        }
        def flutterProperties = new File(rootDir.parentFile, ".flutter-plugins")
        if (flutterProperties.exists()) {
            return flutterProperties.parentFile.parentFile.parentFile.absolutePath
        }
        throw new GradleException("FLUTTER_ROOT not found and .flutter-plugins not found")
    }
    settings.ext.flutterSdkPath = flutterSdkPath()

    includeBuild "${settings.ext.flutterSdkPath}/packages/flutter_tools/gradle"

    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}

plugins {
    id "dev.flutter.flutter-gradle-plugin" version "1.0.0" apply false
}

include ":app"

def localPropertiesFile = new File(rootDir, "local.properties")
def properties = new Properties()

if (localPropertiesFile.exists()) {
    localPropertiesFile.withInputStream { stream -> properties.load(stream) }
}

def flutterSdkPath = properties.getProperty("flutter.sdk")
if (flutterSdkPath == null) {
    flutterSdkPath = System.getenv("FLUTTER_SDK")
}
if (flutterSdkPath == null) {
    flutterSdkPath = "${System.getenv("FLUTTER_ROOT")}"
}
settings.ext.set("flutter.sdk", flutterSdkPath)

def flutterVersionCode = properties.getProperty("flutter.versionCode")
if (flutterVersionCode == null) {
    flutterVersionCode = "1"
}
settings.ext.set("flutter.versionCode", flutterVersionCode.toInteger())

def flutterVersionName = properties.getProperty("flutter.versionName")
if (flutterVersionName == null) {
    flutterVersionName = "1.0"
}
settings.ext.set("flutter.versionName", flutterVersionName)
